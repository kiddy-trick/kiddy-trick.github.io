var shoppingCart=function(){function a(a,b,c,f){this.product=a;this.price=b;this.count=c;this.url=f}function c(){localStorage.setItem("shoppingCart",JSON.stringify(cart))}cart=[];null!=localStorage.getItem("shoppingCart")&&(cart=JSON.parse(localStorage.getItem("shoppingCart")));return{addItemToCart:function(d,b,g,f){for(var e in cart)if(cart[e].url===d){cart[e].count++;c();return}e=new a(f,b,g,d);cart.push(e);c()},setCountForItem:function(a,b){for(var d in cart)if(cart[d].url===a){cart[d].count=b;
break}},removeItemFromCart:function(a){for(var b in cart)if(cart[b].url===a){cart[b].count--;0===cart[b].count&&cart.splice(b,1);break}c()},removeItemFromCartAll:function(a){for(var b in cart)if(cart[b].url===a){cart.splice(b,1);break}c()},clearCart:function(){cart=[];c()},totalCount:function(){var a=0,b;for(b in cart)a+=cart[b].count;return a},totalCart:function(){var a=0,b;for(b in cart)a+=cart[b].price*cart[b].count;return Number(a.toFixed(2))},listCart:function(){var a=[];for(i in cart){item=
cart[i];itemCopy={};for(p in item)itemCopy[p]=item[p];itemCopy.total=Number(item.price*item.count).toFixed(2);a.push(itemCopy)}return a}}}();function numberWithSpaces(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}
$(".add-to-cart").click(function(a){a.preventDefault();a.stopPropagation();a=$(this).data("name");var c=Number($(this).data("price")),d=$(this).data("url");0==shoppingCart.totalCount()&&($("#cart").toggleClass("visible"),$("body").toggleClass("menu-visible"));$(this).html("\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e");shoppingCart.addItemToCart(d,c,1,a);displayCart()});$(".clear-cart").click(function(){shoppingCart.clearCart();displayCart()});
function displayCart(){var a=shoppingCart.listCart(),c=shoppingCart.totalCart(),d="",b;for(b in a)d+='<div class="cart-item"><a href="'+a[b].url+'"><img class="image" src="/images/catalog'+a[b].url+'-01_400w.jpg"></a><div class="cart-text"><a href="'+a[b].url+'">'+a[b].product+"</a><h3>"+numberWithSpaces(a[b].price)+' &#8381;</h3><div><a class="minus-item button" data-url='+a[b].url+">-</a><span>"+a[b].count+'</span><a class="plus-item button" data-url='+a[b].url+">+</a></div></div></div>";$(".show-cart").fadeOut(200);
window.setTimeout(function(){$(".show-cart").html(d)},200);$(".cart-string").attr("value",c);$(".show-cart").fadeIn(200);$(".total-cart").html(numberWithSpaces(shoppingCart.totalCart()));$(".total-count").html(shoppingCart.totalCount());0<shoppingCart.totalCount()&&$(".order").hasClass("disabled")?$(".order").removeClass("disabled"):0!=shoppingCart.totalCount()||$(".order").hasClass("disabled")||$(".order").addClass("disabled")}
$(".show-cart").on("click",".delete-item",function(a){a.preventDefault();a.stopPropagation();a=$(this).data("url");shoppingCart.removeItemFromCartAll(a);displayCart()});$(".show-cart").on("click",".minus-item",function(a){a.preventDefault();a.stopPropagation();a=$(this).data("url");shoppingCart.removeItemFromCart(a);displayCart()});$(".show-cart").on("click",".plus-item",function(a){a.preventDefault();a.stopPropagation();a=$(this).data("url");shoppingCart.addItemToCart(a);displayCart()});
$(".show-cart").on("change",".item-count",function(a){a=$(this).data("url");var c=Number($(this).val());shoppingCart.setCountForItem(a,c);displayCart()});displayCart();